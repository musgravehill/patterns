define("OfficeFabric/components/CommandBar/CommandBar",["require","exports","tslib","react","../../Utilities","../../FocusZone","../../ContextualMenu","../../utilities/contextualMenu/index","../../Icon","../../Styling","../../Tooltip","./CommandBar.scss","../../Utilities","../../KeytipData"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=l,p="overflow",w=41.5,b=function(n){function t(t){var r=n.call(this,t)||this;return r._searchSurface=a.createRef(),r._commandSurface=a.createRef(),r._commandBarRegion=a.createRef(),r._farCommandSurface=a.createRef(),r._focusZone=a.createRef(),r._overflow=a.createRef(),r._onOverflowClick=function(n){r.state.expandedMenuItemKey===p?r._onContextMenuDismiss():r.setState({expandedMenuId:n.currentTarget.id,expandedMenuItemKey:p,contextualMenuProps:i.__assign({},r.props.overflowMenuProps,{items:r.state.renderedOverflowItems}),contextualMenuTarget:n.currentTarget})},r._onContextMenuDismiss=function(n){var i=r._commandSurface.current,t;if(n&&n.relatedTarget&&(!i||i.contains(n.relatedTarget)))n.stopPropagation(),n.preventDefault();else{if(t=r.state.contextualMenuProps,t&&t.onDismiss)t.onDismiss(n);r.setState({expandedMenuItemKey:undefined,contextualMenuProps:undefined,contextualMenuTarget:undefined})}},r.state=r._getStateFromProps(t),r._id=u.getId("CommandBar"),r}return i.__extends(t,n),t.prototype.componentDidMount=function(){this._asyncMeasure();this._events.on(window,"resize",this._updateRenderedItems)},t.prototype.componentWillReceiveProps=function(n){this.setState(this._getStateFromProps(n));this._commandItemWidths=null},t.prototype.componentDidUpdate=function(){this._commandItemWidths||this._asyncMeasure()},t.prototype.render=function(){var b=this,t=this.props,tt=t.isSearchBoxVisible,it=t.searchPlaceholderText,rt=t.className,ut=t.ariaLabel,n=this.state,k=n.renderedItems,d=n.contextualMenuProps,v=n.expandedMenuItemKey,ft=n.expandedMenuId,o=n.renderedOverflowItems,et=n.contextualMenuTarget,g=n.renderedFarItems,nt,l,a,w;return tt&&(nt=r.createElement("div",{className:u.css("ms-CommandBarSearch",y.search),ref:this._searchSurface},r.createElement("input",{className:u.css("ms-CommandBarSearch-input",y.searchInput),type:"text",placeholder:it}),r.createElement("div",{className:u.css("ms-CommandBarSearch-iconWrapper ms-CommandBarSearch-iconSearchWrapper",y.searchIconWrapper,y.searchIconSearchWrapper)},r.createElement(s.Icon,{iconName:"Search"})),r.createElement("div",{className:u.css("ms-CommandBarSearch-iconWrapper ms-CommandBarSearch-iconClearWrapper",h.FontClassNames.small,y.searchIconWrapper,y.searchIconClearWrapper)},r.createElement(s.Icon,{iconName:"cancel"})))),l=k.length+g.length+(o&&o.length>0?1:0),a=1,r.createElement("div",{className:u.css("ms-CommandBar",y.root,rt),ref:this._commandBarRegion},nt,r.createElement(f.FocusZone,{componentRef:this._focusZone,className:y.container,direction:f.FocusZoneDirection.horizontal,role:"menubar","aria-label":ut},r.createElement("div",{className:u.css("ms-CommandBar-primaryCommands",y.primaryCommands),ref:this._commandSurface},k.map(function(n){return b._renderItemInCommandBar(n,a++,l,v)}).concat(o&&o.length?[r.createElement("div",{className:u.css("ms-CommandBarItem",y.item),key:p,ref:this._overflow},r.createElement(c.TooltipHost,{content:this.props.elipisisAriaLabel},r.createElement("button",{type:"button",id:this._id+p,className:u.css("ms-CommandBarItem-link",y.itemLink,(w={},w["is-expanded "+y.itemLinkIsExpanded]=v===p,w)),onClick:this._onOverflowClick,role:"menuitem","aria-expanded":this.state.expandedMenuItemKey===p,"aria-label":this.props.elipisisAriaLabel||"","aria-haspopup":!0,"aria-setsize":l,"aria-posinset":a++,"data-automation-id":"commandBarOverflow"},r.createElement(s.Icon,{className:u.css("ms-CommandBarItem-overflow",y.itemOverflow),iconName:"more"}))))]:[])),r.createElement("div",{className:u.css("ms-CommandBar-sideCommands",y.sideCommands),ref:this._farCommandSurface},g.map(function(n){return b._renderItemInCommandBar(n,a++,l,v,!0)}))),d?r.createElement(e.ContextualMenu,i.__assign({className:"ms-CommandBar-menuHost",directionalHint:7},d,{target:et,labelElementId:ft,onDismiss:this._onContextMenuDismiss})):null)},t.prototype.focus=function(){var n=this._focusZone.current;n&&n.focus()},t.prototype._renderItemInCommandBar=function(n,t,f,e){var b=this,h,rt,ut,et;if(n.onRender)return r.createElement("div",{className:u.css("ms-CommandBarItem",y.item,n.className),role:"menuitem","aria-setsize":f,"aria-posinset":t,key:n.key,ref:n.key,"aria-label":n.ariaLabel,"data-is-focusable":!1},n.onRender(n,this._onContextMenuDismiss));var k=this._id+n.key,a=n.key||String(t),ft=n.onClick||o.hasSubmenu(n),d=u.css(ft?"ms-CommandBarItem-link "+y.itemLink:"ms-CommandBarItem-text "+y.itemText,!n.name&&"ms-CommandBarItem--noName "+y.itemLinkIsNoName,e===n.key&&"is-expanded "+y.itemLinkIsExpanded,n.inactive?y.inactive:""),p="",g="";n.title&&(p=k+"tooltip",g=n.title);var nt=!!n.icon||!!n.iconProps,tt=!!n.name&&!n.iconOnly,it=n.ariaLabel||(n.iconOnly?n.name:undefined),l=o.hasSubmenu(n),w=n.keytipProps;return w&&l&&(w=i.__assign({},w,{hasMenu:!0})),n.href?(rt=u.getNativeProps(n,u.anchorProperties.concat(["disabled"])),h=r.createElement(v.KeytipData,{keytipProps:w,ariaDescribedBy:rt["aria-describedby"],disabled:n.disabled},function(e){return r.createElement("a",i.__assign({},rt,e,{id:k,className:d,href:n.disabled?undefined:n.href,onClick:b._onItemClick(n),title:"","aria-disabled":n.inactive,"data-command-key":a,"aria-haspopup":l,role:"menuitem","aria-label":it,"aria-setsize":f,"aria-posinset":t,"aria-describedby":p}),nt?b._renderIcon(n):null,tt&&r.createElement("span",{className:u.css("ms-CommandBarItem-commandText",y.itemCommandText)},n.name))})):ft?(ut=u.getNativeProps(n,u.buttonProperties),h=r.createElement(v.KeytipData,{keytipProps:w,ariaDescribedBy:ut["aria-describedby"],disabled:n.disabled},function(o){return r.createElement("button",i.__assign({},ut,o,{id:k,className:d,onClick:b._onItemClick(n),title:"","aria-disabled":n.inactive,"data-command-key":a,"aria-haspopup":l,"aria-expanded":l?e===n.key:undefined,role:"menuitem","aria-label":it,"aria-setsize":f,"aria-posinset":t,"aria-describedby":p}),nt?b._renderIcon(n):null,tt&&r.createElement("span",{className:u.css("ms-CommandBarItem-commandText",y.itemCommandText)},n.name),l?r.createElement(s.Icon,{className:u.css("ms-CommandBarItem-chevronDown",y.itemChevronDown),iconName:"ChevronDown"}):null)})):(et=u.getNativeProps(n,u.divProperties.concat(["disabled"])),h=r.createElement("div",i.__assign({},et,{id:k,className:d,title:"","aria-disabled":n.inactive,"data-command-key":a,"aria-haspopup":l,"aria-label":it,"aria-setsize":f,"aria-posinset":t,role:"menuitem","aria-describedby":p}),nt?this._renderIcon(n):null,tt&&r.createElement("span",{className:u.css("ms-CommandBarItem-commandText",y.itemCommandText),"aria-hidden":"true",role:"presentation"},n.name))),n.iconOnly&&n.name?h=r.createElement(c.TooltipHost,{content:n.name},h):g&&(h=r.createElement(c.TooltipHost,{id:p,setAriaDescribedBy:!1,content:g},h)),r.createElement("div",{className:u.css("ms-CommandBarItem",y.item,n.className),key:a,ref:a},h)},t.prototype._renderIcon=function(n){var t=n.iconProps?n.iconProps:{iconName:n.icon},f=t.iconName==="None"?"":"ms-CommandBarItem-iconColor "+y.itemIconColor,e=u.css("ms-CommandBarItem-icon",y.itemIcon,f,t.className);return r.createElement(s.Icon,i.__assign({},t,{className:e}))},t.prototype._asyncMeasure=function(){var n=this;this._async.requestAnimationFrame(function(){n._updateItemMeasurements();n._updateRenderedItems()})},t.prototype._updateItemMeasurements=function(){var n,t,i;for(this._overflowWidth=this._overflow.current||this.props.overflowItems&&this.props.overflowItems.length?w:0,this._commandItemWidths||(this._commandItemWidths={}),n=0;n<this.props.items.length;n++)t=this.props.items[n],this._commandItemWidths[t.key]||(i=this.refs[t.key],i&&(this._commandItemWidths[t.key]=i.getBoundingClientRect().width))},t.prototype._updateRenderedItems=function(){var f=this.props,b=f.items,r=f.overflowItems,k=f.overflowMenuProps,c=this._commandSurface.current,l=this._farCommandSurface.current,a=this._commandBarRegion.current,v=this._searchSurface.current,i=b.slice(),e=r,o=0,y=r&&r.length,s,t,n,p,h,u;if(c&&a){if(s=window.getComputedStyle(c),t=a.clientWidth-parseInt(s.marginLeft,10)-parseInt(s.marginRight,10),v&&(t-=v.getBoundingClientRect().width),l&&(t-=l.getBoundingClientRect().width),y&&(t-=this._overflowWidth),!this._commandItemWidths){this._asyncMeasure();return}for(n=0;n<i.length;n++)if(p=i[n],h=this._commandItemWidths[p.key],o+h>=t){n>0&&!y&&t-o<w&&n--;e=i.splice(n).concat(r);break}else o+=h;u=this._getContextualMenuPropsAfterUpdate(i.concat(this.state.renderedFarItems),e,k);this.setState({renderedItems:i,renderedOverflowItems:e,expandedMenuItemKey:u?this.state.expandedMenuItemKey:undefined,contextualMenuProps:u,contextualMenuTarget:u?this.state.contextualMenuTarget:undefined})}},t.prototype._onItemClick=function(n){var t=this;return function(i){if(!n.inactive&&(n.key!==t.state.expandedMenuItemKey&&o.hasSubmenu(n)?t.setState({expandedMenuId:i.currentTarget.id,expandedMenuItemKey:n.key,contextualMenuProps:t._getContextualMenuPropsFromItem(n),contextualMenuTarget:i.currentTarget}):t._onContextMenuDismiss(),n.onClick))n.onClick(i,n)}},t.prototype._getStateFromProps=function(n){return{renderedItems:n.items||[],contextualMenuProps:this._getContextualMenuPropsAfterUpdate(n.items.concat(n.farItems),n.overflowItems,n.overflowMenuProps),renderedFarItems:n.farItems||undefined}},t.prototype._getContextualMenuPropsAfterUpdate=function(n,t,r){var f=this,u;if(this.state&&this.state.expandedMenuItemKey){if(this.state.expandedMenuItemKey===p)return i.__assign({},r,{items:t});if(u=n.filter(function(n){return n.key===f.state.expandedMenuItemKey}),u.length===1)return this._getContextualMenuPropsFromItem(u[0])}return},t.prototype._getContextualMenuPropsFromItem=function(n){return n.subMenuProps||n.items&&{items:n.items}},t.defaultProps={items:[],overflowItems:[],farItems:[]},t}(u.BaseComponent);t.CommandBar=b});

